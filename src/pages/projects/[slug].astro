---
import Layout from "../../layouts/main.astro";

/**
 * 1. Generamos todas las rutas estáticas a partir del JSON.
 */
export async function getStaticPaths() {
  // Import dinámico para que solo se cargue en build
  const projects = (await import("../../collections/projects.json")).default;

  return projects
    .filter(p => !!p.slug) // Solo los que tienen slug
    .map(p => ({
      params: { slug: p.slug },
      props: { project: p } // pasamos el objeto como props para no volver a buscar
    }));
}

// (Opcional) Aseguramos que esta ruta se pre-renderice (en output static no es obligatorio)
// export const prerender = true;

/**
 * 2. Obtenemos el proyecto pasado vía props (proveniente de getStaticPaths).
 */
const { project } = Astro.props;
---

<Layout title={project.name}>
  <section class="max-w-3xl mx-auto my-12 px-6">
    <a href="/projects" class="text-sm text-neutral-500 hover:underline">&larr; Volver</a>

    <h1 class="mt-4 text-3xl font-bold dark:text-white">{project.name}</h1>
    <p class="mt-4 text-neutral-700 dark:text-neutral-300">
      {project.description}
    </p>

    {project.image && (
      <div class="mt-8 rounded-xl overflow-hidden border border-neutral-300 dark:border-neutral-700">
        <img
          src={project.image}
          alt={project.name}
          class="w-full object-cover"
          loading="eager"
          decoding="async"
        />
      </div>
    )}
  </section>
</Layout>